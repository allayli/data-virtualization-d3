<html>
    <body>
        <center> <h3>Countries Count in Partition Graph </h3> </center>
        <script src="https://d3js.org/d3.v3.min.js"></script>
        <script>
          var width = parseInt(window.innerWidth * 0.9),
          height = parseInt(window.innerHeight * 0.9),
          radius = Math.min(width, height) / 2,
          color = function(){
            return "hsl(" + (~~(Math.random()*360%360)) + ", 180%, 50%)";
          };

          var svg = d3.select("body").append("svg")
          .attr("width", width)
          .attr("height", height)
          .append("g")
          .attr("transform", "translate(" + width / 2 + "," + height * .5 + ")");

          var partition = d3.layout.partition()
          .sort(null)
          .size([2 * Math.PI, radius * radius])
          .value(function(d) { return 1; });

          var arc = d3.svg.arc()
          .startAngle(function(d) { return d.x; })
          .endAngle(function(d) { return d.x + d.dx; })
          .innerRadius(function(d) { return Math.sqrt(d.y); })
          .outerRadius(function(d) { return Math.sqrt(d.y + d.dy); });

          d3.csv("data.csv", function(data) {
            console.log(data);
            var dataset = {
              "name": "Address",
              "children": []
            };
            var countries = {};
            var cities = {};

            for (var i=0; i<data.length; i++) {
              if(countries[data[i].countries]){
                countries[data[i].countries]++;
              } else {
                countries[data[i].countries] = 1;
              }
            }
            for (var i=0; i<data.length; i++) {
              if(cities[data[i].cities]){
                cities[data[i].cities]++;
              } else {
                cities[data[i].cities] = 1;
              }
            }
            console.log(cities);
            for (var key in countries) {
              dataset.children.push({
                "name": key,
                "size": countries[key]
              })
            }
            console.log(dataset);
            var path = svg.datum(dataset).selectAll("path")
            .data(partition.nodes)
            .enter().append("path")
            .attr("display", function(d) { return d.depth ? null : "none"; }) // hide inner ring
            .attr("d", arc)
            .style("stroke", "#fff")
            .style("fill", color)
            .style("fill-rule", "evenodd")
            .each(stash);

            var value = function(d) { return d.size; };

            path
            .data(partition.value(value).nodes)
            .transition()
            .duration(1500)
            .attrTween("d", arcTween);

            path.append("svg:title")
            .text(function(d) { return d.name + ":" + d.size; });
          });

          // Stash the old values for transition.
          function stash(d) {
            d.x0 = d.x;
            d.dx0 = d.dx;
          }

          // Interpolate the arcs in data space.
          function arcTween(a) {
            var i = d3.interpolate({x: a.x0, dx: a.dx0}, a);
            return function(t) {
              var b = i(t);
              a.x0 = b.x;
              a.dx0 = b.dx;
              return arc(b);
            };
          }

          d3.select(self.frameElement).style("height", height + "px");
        </script>
    </body>
</html>
